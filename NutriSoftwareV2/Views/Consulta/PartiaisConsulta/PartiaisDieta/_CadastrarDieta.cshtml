@model NutriSoftware.Negocio.Domain.Dieta
@{

    int contador = 0;
    int ContaAlimentos = 0;
    int contaSub = 0;
    int cantadorIntervalo = 0;
    var x = Model;
}

<div class="row pt-2 pl-5 pr-5">
    <div class="container-fluid fixed-top pl-5 pr-5 " style="z-index:100; margin-top:70px;" id="pnlCamposSuperiores">

        <div class="row bg-light mt-1 pl-2 pr-2">
            <div class="col-lg-2 col-md-2 col-sm-12">
                <div class="row m-0 p-0">
                    <h6>Horário</h6>
                    <div class="col-12 p-1">
                        <input type="text" onblur="verificaHorarioCorreto(this.value)" mask="hora" id="horario" class="form-control w-100" />
                    </div>
                </div>
            </div>

            <div class="col-lg-5 col-md-5 col-sm-12 p-">
                <form method="post" id="frmInserirAlimentos" class="m-0 p-0" style="width:100%">
                    <h6>Alimentos</h6>
                    <div class="row p-0 m-0">
                        <div class="col-6 p-1">
                            <input type="text" onblur="habilitarbotoes(1)" id="txtAlimento" class="form-control w-100" />
                            <input type="hidden" name="AlimentoId" id="txtAlimentoId" class="form-control" />
                            <input type="hidden" name="Tipo" value="1" class="form-control w-100" />
                            <input type="hidden" name="CodigoDieta" value="@ViewBag.CodigoDieta" class="form-control w-100" />
                            <input type="hidden" name="Hora" class="form-control w-100 hora" />
                        </div>
                        <div class="col-2 p-1">
                            <input type="text" onblur="habilitarbotoes(1)" name="QuantidadeAlimento" mask="Qtd" id="txtQuantidadeAlimento" class="form-control w-100" />
                        </div>
                        <div class="col-4 p-1">
                            <input type="text" onblur="habilitarbotoes(1)" id="txtTpMedidaAlimento" class="form-control w-100" />
                            <input type="hidden" name="TipoMedidaAlimentoId" id="txtTpMedidaAlimentoId" class="form-control w-100" />
                        </div>
                        <div class="col-12 p-0 pb-1">
                            <button type="button" onclick="adicionarAlimentos(1)" id="btnInserirAlimentos" class="btn btn-primary float-lg-right m-1"><i class="fa fa-plus"></i> Adicionar</button>
                            <button class="btn btn-info float-lg-right m-1"><i class="fa fa-history"></i> Limpar</button>

                        </div>
                    </div>
                </form>
            </div>

            <div class="col-lg-5 col-md-5 col-sm-12 p-0">
                <form method="post" id="frmInserirSubAlimentos" class="p-0 m-0" style="width:100%">
                    <h6>Substituições</h6>
                    <div class="row p-0 m-0">
                        <div class="col-6 p-1">
                            <input type="text" onblur="habilitarbotoes(2)" id="txtSubstituicao" class="form-control w-100" />
                            <input type="hidden" name="AlimentoId" id="txtSubstituicaoId" class="form-control w-100" />
                            <input type="hidden" name="Tipo" value="2" class="form-control w-100" />
                            <input type="hidden" name="CodigoDieta" value="@ViewBag.CodigoDieta" class="form-control w-100" />
                            <input type="hidden" name="Hora" class="form-control w-100 hora" />
                        </div>
                        <div class="col-2 p-1">
                            <input type="text" onblur="habilitarbotoes(2)" name="QuantidadeAlimento" mask="Qtd" id="quantidadeSubAlimento" class="form-control w-100" />
                        </div>
                        <div class="col-4 p-1">
                            <input type="text" onblur="habilitarbotoes(2)" id="txtTpMedidaSubsAlimento" class="form-control w-100" />
                            <input type="hidden" name="TipoMedidaAlimentoId" id="txtTpMedidaSubsAlimentoId" class="form-control w-100" />
                        </div>
                        <div class="col-12 p-0 pb-1">
                            <button type="button" onclick="adicionarAlimentos(2)" id="btnInseriSubstituicoes" class="btn btn-primary float-lg-right m-1"><i class="fa fa-plus"></i> Adicionar</button>
                            <button class="btn btn-info float-lg-right m-1"><i class="fa fa-history"></i> Limpar</button>
                        </div>
                    </div>
                </form>

            </div>

        </div>
    </div>

    <div class="container pl-5 pr-5 pb-2" style="border: solid 2px #c4c0c0; margin-top: 235px;" id="prtListaAlimentos">
        <h3 class="text-center" style="background-color: #acacac; border-radius: 0 0 50px 50px; padding: 5px 0; color: #6c6b6b;">Dieta</h3>

        @if (Model?.PlanosAlimentares != null)
        {
            @foreach (var hora in Model.PlanosAlimentares)
            {
                contador += 1;

                var alimentosHora = hora.QuantidadeAlimentos.Where(p => p.Hora == hora.HoraAlimentos && p.Tipo == NutriSoftware.Negocio.Enums.EN_TipoDietaAlimentos.Alimento).ToList();
                var SubAlimentosHora = hora.QuantidadeAlimentos.Where(p => p.Hora == hora.HoraAlimentos && p.Tipo == NutriSoftware.Negocio.Enums.EN_TipoDietaAlimentos.Substituicao).ToList();
                var intervalo = hora.QuantidadeAlimentos.Where(p => p.Hora == hora.HoraAlimentos && p.Tipo == NutriSoftware.Negocio.Enums.EN_TipoDietaAlimentos.Intervalo).ToList();
                int rowSpan = alimentosHora.ToList().Count < 1 ? 1 : alimentosHora.ToList().Count;
                <div id="linha_@hora.HoraAlimentos.Replace(":","")">
                    <div class="row">
                        <div class="col-lg-2 col-md-2 col-sm-12">
                            <h6>Horário</h6>
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td rowspan="@rowSpan">
                                            <p style="font-size:22px;"><b>@hora.HoraAlimentos</b></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="col-lg-5 col-md-5 col-sm-12" id="pnlCamposInternos">
                            <h6>Alimentos</h6>
                            <table class="table" id="tableAlimentos">
                                <tbody>
                                    @foreach (var alimentos in alimentosHora)
                                    {
                                        ContaAlimentos += 1;

                                        <tr>
                                            <td class="p-0">@alimentos.Alimento.Nome</td>
                                            <td class="p-0">@alimentos.Quantidade</td>
                                            <td class="p-0">@alimentos.TipoMedida.Descricao</td>
                                            <td class="p-0 btnRemoveItemAlimentos">
                                                <form method="post" class="p-0 m-0 w-100" id="frmRemoveAlimento_@ContaAlimentos">
                                                    <input type="hidden" name="CodigoDieta" value="@hora.CodigoDieta" />
                                                    <input type="hidden" name="Hora" value="@alimentos.Hora" />
                                                    <input type="hidden" name="AlimentoId" value="@alimentos.Alimento.Id" />
                                                    <input type="hidden" name="Tipo" value="1" />
                                                    <button type="button" value="frmRemoveAlimento_@ContaAlimentos" onclick="removerItem(this.value)" class="btn btn-light" style="border-radius:25px">
                                                        <i title="remover" class="fa fa-remove"></i>
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div class="col-lg-5 col-md-5 col-sm-12">
                            <h6>Substituições</h6>
                            <table class="table" id="tableSusbstituicoes">
                                <tbody>
                                    @if (SubAlimentosHora.Any() && SubAlimentosHora.Count > 0)

                                        @foreach (var subAlimentos in SubAlimentosHora)
                                        {
                                            contaSub += 1;

                                            <tr>
                                                <td class="p-0">@subAlimentos.Alimento.Nome</td>
                                                <td class="p-0">@subAlimentos.Quantidade</td>
                                                <td class="p-0">@subAlimentos.TipoMedida.Descricao</td>
                                                <td class="p-0 btnRemoveItemSubstituicoes">
                                                    <form method="post" class="p-0 m-0 w-100" id="frmRemoveSubAlimento_@contaSub">
                                                        <input type="hidden" name="CodigoDieta" value="@subAlimentos.CodigoDieta" />
                                                        <input type="hidden" name="Hora" value="@subAlimentos.Hora" />
                                                        <input type="hidden" name="AlimentoId" value="@subAlimentos.Alimento.Id" />
                                                        <input type="hidden" name="Tipo" value="2" />
                                                        <button type="button" value="frmRemoveSubAlimento_@contaSub" onclick="removerItem(this.value)" class="btn btn-light" style="border-radius:25px">
                                                            <i title="remover" class="fa fa-remove"></i>
                                                        </button>
                                                    </form>

                                                </td>
                                            </tr>
                                        }

                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="row">
                        <h6 class="ml-3">Observações</h6>
                        <div class="col-12">
                            <form method="post" id="frmObservacao_@contador">
                                <input type="hidden" name="HorarioReferencia" value="@hora.HoraAlimentos" />
                                <input type="hidden" name="CodigoDieta" value="@hora.CodigoDieta" />
                                <textarea name="Anotacoes" class="form-control bg-light txaObservacoes" onblur="inserirObservacaoDieta(@contador)" rows="4" style="resize:none; padding-bottom:2px;">@hora?.ObservacaoPlano?.Anotacoes?.Replace("<br/>", "\n")</textarea>
                            </form>
                        </div>
                    </div>

                    <div class="row pl-3 linhasform">
                        <form method="post" id="frmInserirIntervalos_@contador" class="p-0 m-0" style="width:100%">

                            <h6 class="m-auto">Intervalos</h6>
                            <div class="row p-0 m-0 linhasIntervalos" id="pnlcamposIntevalos">
                                <div class="col-10">
                                    <div class="row p-0">
                                        <div class="col-5 p-1">
                                            <input type="text" onblur="habilitarbotoes(3,@contador)" id="txtIntervalo_@contador" onfocus="buscarIntervalos(@contador)" class="form-control w-100 txtIntervalo" />
                                            <input type="hidden" name="AlimentoId" id="txtIntervaloId_@contador" class="form-control w-100" />
                                            <input type="hidden" name="Tipo" value="3" class="form-control w-100" />
                                            <input type="hidden" name="CodigoDieta" value="@hora.CodigoDieta" class="form-control w-100" />
                                            <input type="hidden" name="Hora" value="@hora.HoraAlimentos" id="horaIntervalo_@contador" class="form-control w-100 hora" />
                                        </div>
                                        <div class="col-2 p-1">
                                            <input type="text" onblur="habilitarbotoes(3,@contador)" name="QuantidadeAlimento" id="quantidadeIntervaloAlimento_@contador" class="form-control w-100" />
                                        </div>
                                        <div class="col-4 p-1">
                                            <input type="text" onblur="habilitarbotoes(3,@contador)" id="txtTpIntervalo_@contador" onfocus="buscarTipoMedidaIntevalos(@contador)" class="form-control w-100" />
                                            <input type="hidden" name="TipoMedidaAlimentoId" id="txtTpIntervaloId_@contador" class="form-control w-100" />
                                        </div>
                                        <div class="col-1 p-0 pt-1 pb-1">
                                            <button type="button" class="btn btn-outline-secondary"><i class="fa fa-history"></i> Limpar</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-2 p-0 pl-2 pt-1 pb-1 dvbtnAdicionar">
                                    <button type="button" class="btn btn-primary" id="btnInserirIntervalos_@contador" onclick="adicionarIntervalos(@contador)"> <i class="fa fa-plus"></i> Adicionar</button>
                                </div>
                            </div>

                        </form>
                        <div class="col-12 p-2" style="border-top: solid 1px #c4c0c0; border-bottom: solid 2px #c4c0c0; ">
                            @if (intervalo != null)
                            {
                                <table class="table tableIntervalos">

                                    <tbody>
                                        @foreach (var intevaloAlimento in intervalo)
                                        {
                                            cantadorIntervalo += 1;
                                            var descricao = $"{intevaloAlimento.Alimento.Nome} - {intevaloAlimento.Quantidade}  {intevaloAlimento.TipoMedida.Descricao}";
                                            <tr>
                                                <td class="p-0 text-center w-75">
                                                    @descricao
                                                </td>
                                                <td class="p-0 btnRemoveItemIntervalos">
                                                    <form method="post" class="p-0 m-0 w-100" id="frmRemoveIntervalo_@cantadorIntervalo">
                                                        <input type="hidden" name="CodigoDieta" value="@hora.CodigoDieta" />
                                                        <input type="hidden" name="Hora" value="@intevaloAlimento.Hora" />
                                                        <input type="hidden" name="AlimentoId" value="@intevaloAlimento.Alimento.Id" />
                                                        <input type="hidden" name="Tipo" value="3" />
                                                        <button type="button" value="frmRemoveIntervalo_@cantadorIntervalo" onclick="removerItem(this.value)" class="btn btn-light" style="border-radius:25px">
                                                            <i title="remover" class="fa fa-remove"></i>
                                                        </button>
                                                    </form>
                                                </td>
                                            </tr>
                                        }

                                    </tbody>
                                </table>

                            }
                        </div>
                    </div>
                </div>
            }
        }
        <div class="row mt-1" id="pnlBotaoEditarDieta" style="display: none; margin: auto; margin-bottom: 62px;">
            <div class="col-6 pl-0 pr-0">
                <button type="button" class="btn btn-secondary"> <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Editar</button>
            </div>
        </div>
    </div>

</div>
<div id="pnlBotoesAvancar" class="mt-1">
    <form method="post" class="p-0 m-0" id="frmCadastrarDietaConsulta">
        <div class="row" style="width:18%; margin:auto; margin-bottom:62px;">

            <input type="hidden" name="Codigo" value="@Model?.CodigoDieta" />
            <input type="hidden" name="PacienteId" value="@Model?.PacienteId" />

            <div class="col-6">
                <button type="button" class="btn btn-primary w-100"><i class="fa fa-chevron-left" aria-hidden="true"></i> Anterior </button>
            </div>
            <div class="col-6">
                <button type="button" onclick="inserirDieta()" class="btn btn-primary w-100"> Proximo <i class="fa fa-chevron-right" aria-hidden="true"></i></button>
            </div>
        </div>
    </form>
</div>




@*@section Scripts{
        <script>
    $(document).ready(function () {

                var hora = $("#horario").val();
                var alimento = $("#txtAlimento").val();
                var alimentoId = $("#AlimentoId").val();
                var qtdAlimento = $("#txtQuantidadeAlimento").val();
                var tipoMedida = $("#txtTpMedidaAlimento").val();
                var tipoMedidaId = $("#TipoMedidaAlimentoId").val();

                var subAlimento = $("#txtSubstituicao").val();
                var subAlimentoId = $("#txtSubstituicaoId").val();
                var subQuantidade = $("#quantidadeSubAlimento").val();
                var tipoSubMedida = $("#txtTpMedidaSubsAlimento").val();
                var tipoSubMedidaId = $("#txtTpMedidaSubsAlimentoId").val();

                var habilitarBotaoAlimentos = !(
                    hora != "" &&
                    alimento != "" &&
                    alimentoId != "" &&
                    qtdAlimento != "" &&
                    tipoMedida != "" &&
                    tipoMedidaId != "");

                var habilitarBotaoSubAlimentos = !(
                    hora != "" &&
                    subAlimento != "" &&
                    subAlimentoId != "" &&
                    subQuantidade != "" &&
                    tipoSubMedida != "" &&
                    tipoSubMedidaId != "");




                $('input[mask="hora"]').mask('00:00');
                $('input[mask="Qtd"]').mask("#,##0.00", { reverse: true });
                //$('.money').mask("#,##0.00", { reverse: true });
                $("#btnInserirAlimentos").prop('disabled', habilitarBotaoAlimentos);
                $("#btnInseriSubstituicoes").prop('disabled', habilitarBotaoSubAlimentos);


                habilitarBotoesInserirIntervalos();




                $(function () {
                    $("#txtAlimento").autocomplete({
                        source: function (request, response) {
                            $.ajax({
                                url: "/Dieta/AutoComplete",
                                type: "POST",
                                data: { busca: request.term },
                                dataType: "json",
                                success: function (data) {
                                    response($.map(data, function (item) {
                                        return item;
                                    }))
                                },
                                error: function (response) {
                                    alert(response.responseText);
                                },
                                failure: function (response) {
                                    alert(response.responseText);
                                }
                            });
                        },
                        select: function (e, i) {
                            $("#txtAlimentoId").val(i.item.val);
                        },
                        minLength: 1
                    });
                });

                $(function () {
                    $("#txtSubstituicao").autocomplete({
                        source: function (request, response) {
                            $.ajax({
                                url: "/Dieta/AutoComplete",
                                type: "POST",
                                data: { busca: request.term },
                                dataType: "json",
                                success: function (data) {
                                    response($.map(data, function (item) {
                                        return item;
                                    }))
                                },
                                error: function (response) {
                                    alert(response.responseText);
                                },
                                failure: function (response) {
                                    alert(response.responseText);
                                }
                            });
                        },
                        select: function (e, i) {
                            $("#txtSubstituicaoId").val(i.item.val);
                        },
                        minLength: 1
                    });

                });

                $(function () {
                    $("#txtTpMedidaAlimento").autocomplete({
                        source: function (request, response) {
                            $.ajax({
                                url: "/Dieta/AutoCompleteTipoMedidas",
                                type: "POST",
                                data: { busca: request.term },
                                dataType: "json",
                                success: function (data) {
                                    response($.map(data, function (item) {
                                        return item;
                                    }))
                                },
                                error: function (response) {
                                    alert(response.responseText);
                                },
                                failure: function (response) {
                                    alert(response.responseText);
                                }
                            });
                        },
                        select: function (e, i) {
                            $("#txtTpMedidaAlimentoId").val(i.item.val);
                        },
                        minLength: 1
                    });

                });

                $(function () {
                    $("#txtTpMedidaSubsAlimento").autocomplete({
                        source: function (request, response) {
                            $.ajax({
                                url: "/Dieta/AutoCompleteTipoMedidas",
                                type: "POST",
                                data: { busca: request.term },
                                dataType: "json",
                                success: function (data) {
                                    response($.map(data, function (item) {
                                        return item;
                                    }))
                                },
                                error: function (response) {
                                    alert(response.responseText);
                                },
                                failure: function (response) {
                                    alert(response.responseText);
                                }
                            });
                        },
                        select: function (e, i) {
                            $("#txtTpMedidaSubsAlimentoId").val(i.item.val);
                        },
                        minLength: 1
                    });
                });
            });

            $(function () {
                $("#txtIntervalo").autocomplete({
                    source: function (request, response) {
                        $.ajax({
                            url: "/Dieta/AutoComplete",
                            type: "POST",
                            data: { busca: request.term },
                            dataType: "json",
                            success: function (data) {
                                response($.map(data, function (item) {
                                    return item;
                                }))
                            },
                            error: function (response) {
                                alert(response.responseText);
                            },
                            failure: function (response) {
                                alert(response.responseText);
                            }
                        });
                    },
                    select: function (e, i) {
                        $("#txtIntervaloId").val(i.item.val);
                    },
                    minLength: 1
                });


            });

            $(function () {
                $("#txtTpIntervalo").autocomplete({
                    source: function (request, response) {
                        $.ajax({
                            url: "/Dieta/AutoCompleteTipoMedidas",
                            type: "POST",
                            data: { busca: request.term },
                            dataType: "json",
                            success: function (data) {
                                response($.map(data, function (item) {
                                    return item;
                                }))
                            },
                            error: function (response) {
                                alert(response.responseText);
                            },
                            failure: function (response) {
                                alert(response.responseText);
                            }
                        });
                    },
                    select: function (e, i) {
                        $("#txtTpIntervaloId").val(i.item.val);
                    },
                    minLength: 1
                });
            });
            function verificaHorarioCorreto(horario) {
                if (horario == null || horario.length < 5) {
                    $("#btnInserirAlimentos").prop('disabled', true);
                    toastr.error("Por favor preencha o horario corretamente", "Error");
                    $("#horario").focus();
                    return false;
                }
                if (horario.substr(0, 2) > 23) {
                    $("#btnInserirAlimentos").prop('disabled', true);
                    toastr.error("Por favor preencha o horario corretamente", "Error");
                    $("#horario").focus();
                    return false;
                }
            }

            function habilitarbotoes(botao, id = null) {
                var hora = $("#horario").val();

                verificaHorarioCorreto(hora);

                switch (botao) {
                    case 1:
                        var alimento = $("#txtAlimento").val();
                        var alimentoId = $("#AlimentoId").val();
                        var qtdAlimento = $("#txtQuantidadeAlimento").val();
                        var tipoMedida = $("#txtTpMedidaAlimento").val();
                        var tipoMedidaId = $("#TipoMedidaAlimentoId").val();

                        var habilitarBotaoAlimentos = !(
                            hora != "" &&
                            alimento != "" &&
                            alimentoId != "" &&
                            qtdAlimento != "" &&
                            tipoMedida != "" &&
                            tipoMedidaId != "");

                        $("#btnInserirAlimentos").prop('disabled', habilitarBotaoAlimentos);
                        break;

                    case 2:
                        var subAlimento = $("#txtSubstituicao").val();
                        var subAlimentoId = $("#txtSubstituicaoId").val();
                        var subQuantidade = $("#quantidadeSubAlimento").val();
                        var tipoSubMedida = $("#txtTpMedidaSubsAlimento").val();
                        var tipoSubMedidaId = $("#txtTpMedidaSubsAlimentoId").val();

                        var habilitarBotaoSubAlimentos = !(
                            hora != "" &&
                            subAlimento != "" &&
                            subAlimentoId != "" &&
                            subQuantidade != "" &&
                            tipoSubMedida != "" &&
                            tipoSubMedidaId != "");

                        $("#btnInseriSubstituicoes").prop('disabled', habilitarBotaoSubAlimentos);
                        break;

                    case 3:

                        var IntervaloAlimento = $("#txtIntervalo_" + id).val();
                        var IntervaloAlimentoId = $("#txtIntervaloId_" + id).val();
                        var IntervaloQuantidade = $("#quantidadeIntervaloAlimento_" + id).val();
                        var IntervalotipoSubMedida = $("#txtTpIntervalo_" + id).val();
                        var IntervalotipoSubMedidaId = $("#txtTpIntervaloId_").val();

                        var habilitarBotaoSubAlimentos = !(
                            hora != "" &&
                            IntervaloAlimento != "" &&
                            IntervaloAlimentoId != "" &&
                            IntervaloQuantidade != "" &&
                            IntervalotipoSubMedida != "" &&
                            IntervalotipoSubMedidaId != "");

                        $("#btnInserirIntervalos_" + id).prop('disabled', habilitarBotaoSubAlimentos);
                        break;
                }
            }

            function adicionarAlimentos(tipo) {

                var dados = "";
                var horario = $("#horario").val();
                $(".hora").val(horario)


                switch (tipo) {
                    case 1:
                        var qtdSub = $("#txtQuantidadeAlimento").val().replaceAll(".", ",")
                        $("#txtQuantidadeAlimento").val(qtdSub);
                        dados = $("#frmInserirAlimentos").serialize();
                        break;
                    case 2:
                        var qtdSub = $("#quantidadeSubAlimento").val().replaceAll(".", ",")
                        $("#quantidadeSubAlimento").val(qtdSub);
                        dados = $("#frmInserirSubAlimentos").serialize();
                        break;
                }
                $.ajax({
                    url: '/Dieta/AdicionarAlimento',
                    type: 'POST',
                    data: dados,
                    async: false,
                    success: function (response) {
                        //alert(response)
                        $("#prtListaAlimentos").empty();
                        $("#prtListaAlimentos").append(response);
                        $("#txtAlimento").val("");
                        $("#txtAlimentoId").val("");
                        $("#txtQuantidadeAlimento").val("");
                        $("#TipoMedidaAlimentoId").val("");
                        $("#txtTpMedidaAlimento").val("");
                        $("#txtSubstituicao").val("");
                        $("#txtSubstituicaoId").val("");
                        $("#quantidadeSubAlimento").val("");
                        $("#txtTpMedidaSubsAlimento").val("");
                        $("#txtTpMedidaSubsAlimentoId").val("");

                        habilitarbotoes(tipo);
                        habilitarBotoesInserirIntervalos()

                        $('html, body').animate({ scrollTop: $("#linha_" + horario.replaceAll(":", "")).position().top }, 'slow');

                    },
                    error: function (jqXHR, status, error) {

                        var posicaoInicio = jqXHR.responseText.indexOf(":") + 1;
                        var posicaoFinal = jqXHR.responseText.indexOf("/");
                        /*var err = eval("(" + jqXHR.responseText + ")");*/
                        var mensagemErro = jqXHR.responseText.substring(posicaoInicio, posicaoFinal);
                        toastr.error(mensagemErro, "Error");
                        switch (tipo) {
                            case 1:
                                $("#txtAlimento").val("");
                                $("#AlimentoId").val("");
                                $("#txtQuantidadeAlimento").val("");
                                $("#txtTpMedidaAlimento").val("");
                                $("#TipoMedidaAlimentoId").val("");
                                break;
                            case 2:
                                $("#txtSubstituicao").val("");
                                $("#txtSubstituicaoId").val("");
                                $("#quantidadeSubAlimento").val("");
                                $("#txtTpMedidaSubsAlimento").val("");
                                $("#txtTpMedidaSubsAlimentoId").val("");
                                break;
                        }

                    }

                });

            }


            function habilitarBotoesInserirIntervalos() {
                var existeTxtIntervalo = false;
                var existeTxtIntervaloId = false;
                var existeQuantidadeIntervalo = false;
                var existeTipoMedidaIntervalo = false;
                var existeTipoMedidaIntervaloId = false;

                $.each($('.linhasIntervalos'), function (index, value) {

                    if ($(value).children().children().children().children().is("#txtIntervalo_" + (index + 1))) {
                        var txtIntervalo = $(value).children().children().children().children("#txtIntervalo_" + (index + 1)).val();
                        existeTxtIntervalo = txtIntervalo != "";
                    }
                    if ($(value).children().children().children().children().is("#txtIntervaloId_" + (index + 1))) {
                        var txtIntervaloId = $(value).children().children().children().children("#txtIntervaloId_" + (index + 1)).val();
                        existeTxtIntervaloId = txtIntervaloId != "";
                    }
                    if ($(value).children().children().children().children().is("#quantidadeIntervaloAlimento_" + (index + 1))) {
                        var txtQtdIntervalo = $(value).children().children().children().children("#quantidadeIntervaloAlimento_" + (index + 1)).val();
                        existeQuantidadeIntervalo = txtQtdIntervalo != "";
                    }
                    if ($(value).children().children().children().children().is("#txtTpIntervalo_" + (index + 1))) {
                        var txtTipoItervalo = $(value).children().children().children().children("#txtTpIntervalo_" + (index + 1)).val();
                        existeTipoMedidaIntervalo = txtTipoItervalo != "";
                    }
                    if ($(value).children().children().children().children().is("#txtTpIntervaloId_" + (index + 1))) {
                        var txtTipoItervaloId = $(value).children().children().children().children("#txtTpIntervaloId_" + (index + 1)).val();
                        existeTipoMedidaIntervaloId = txtTipoItervaloId != "";
                    }

                    var habilitaCampo = !(
                        existeTxtIntervalo &&
                        existeTxtIntervaloId &&
                        existeQuantidadeIntervalo &&
                        existeTipoMedidaIntervalo &&
                        existeTipoMedidaIntervaloId);

                    if ($(value).children(".dvbtnAdicionar").children().is("#btnInserirIntervalos_" + (index + 1))) {
                        $(value).children(".dvbtnAdicionar").children("#btnInserirIntervalos_" + (index + 1)).prop('disabled', habilitaCampo)
                    }

                });

            }

            function buscarIntervalos(id) {
                console.log("hora " + id);

                $("#txtIntervalo_" + id).autocomplete({
                    source: function (request, response) {
                        $.ajax({
                            url: "/Dieta/AutoComplete",
                            type: "POST",
                            data: { busca: request.term },
                            dataType: "json",
                            success: function (data) {
                                response($.map(data, function (item) {
                                    return item;
                                }))
                            },
                            error: function (response) {
                                alert(response.responseText);
                            },
                            failure: function (response) {
                                alert(response.responseText);
                            }
                        });
                    },
                    select: function (e, i) {
                        $("#txtIntervaloId_" + id).val(i.item.val);
                    },
                    minLength: 1
                });
            }

            function buscarTipoMedidaIntevalos(id) {
                console.log("Teste " + id);
                $("#txtTpIntervalo_" + id).autocomplete({
                    source: function (request, response) {
                        $.ajax({
                            url: "/Dieta/AutoCompleteTipoMedidas",
                            type: "POST",
                            data: { busca: request.term },
                            dataType: "json",
                            success: function (data) {
                                response($.map(data, function (item) {
                                    return item;
                                }))
                            },
                            error: function (response) {
                                alert(response.responseText);
                            },
                            failure: function (response) {
                                alert(response.responseText);
                            }
                        });
                    },
                    select: function (e, i) {
                        $("#txtTpIntervaloId_" + id).val(i.item.val);
                    },
                    minLength: 1
                });
            };

            function inserirObservacaoDieta(formId) {
                var dados = $("#frmObservacao_" + formId).serialize();
                $.ajax({
                    url: '/Dieta/CadastrarObservacao',
                    type: 'POST',
                    data: dados,
                    async: false,
                    success: function (response) {
                        $("#prtListaAlimentos").empty();
                        $("#prtListaAlimentos").append(response);
                    },
                    error: function (response) {
                        toastr.error("Erro na operação", "Error");
                    }
                });
            }

            function adicionarIntervalos(formId) {

                var dados = $("#frmInserirIntervalos_" + formId).serialize();
                $.ajax({
                    url: '/Dieta/AdicionarAlimento',
                    type: 'POST',
                    data: dados,
                    async: false,
                    success: function (response) {
                        $("#prtListaAlimentos").empty();
                        $("#prtListaAlimentos").append(response);
                        $("#txtIntervalo_" + formId).val("");
                        $("#txtIntervaloId_" + formId).val("");
                        $("#quantidadeAlimento_" + formId).val("");
                        $("#txtTpIntervalo_" + formId).val("");
                        $("#txtTpIntervaloId_" + formId).val("");

                        habilitarBotoesInserirIntervalos()

                    },
                    error: function (response) {
                        toastr.error("Erro na operação", "Error");
                    }
                });

            }

            function removerItem(form) {
                if (form == "" || form == null) {
                    toastr.error("Erro ao localizer formulario de remoção", "Error");
                    return false;
                }

                var form = $("#" + form).serialize();
                $.ajax({
                    url: '/Dieta/RemoverItemDieta',
                    type: 'POST',
                    data: form,
                    async: false,
                    success: function (response) {
                        $("#prtListaAlimentos").empty();
                        $("#prtListaAlimentos").append(response);
                        habilitarBotoesInserirIntervalos();
                    },
                    error: function (response) {
                        toastr.error("Erro na operação", "Error");
                    }
                });
            }
        </script>
    }*@


